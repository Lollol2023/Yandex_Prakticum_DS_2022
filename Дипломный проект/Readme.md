# Промышленность - описание проекта

Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. 

**Задача**

Необходимо построить модель, которая предскажет температуру стали.

## Примечание

Github не отображает интерактивные графики Plotly. Для просмотра с показом графиков можно перейти по [ссылке в nbviewer ](https://nbviewer.org/github/Lollol2023/Yandex_Prakticum_DS_2022/blob/main/Дипломный%20проект/Model_optimizatsii_izderzhek_metallurgia.ipynb#)

## Описание этапа обработки

Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).

Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.

Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. slab, «плита»).

## Описание данных 

Данные состоят из файлов, полученных из разных датасетов:

- `data_arc.csv` — данные об электродах;
- `data_bulk.csv` — данные о подаче сыпучих материалов (объём);
- `data_bulk_time.csv` — данные о подаче сыпучих материалов (время);
- `data_gas.csv` — данные о продувке сплава газом;
- `data_temp.csv` — результаты измерения температуры;
- `data_wire_time.csv` — данные о проволочных материалах (время). Во всех файлах столбец key содержит номер партии. В файлах может быть несколько строк с одинаковым значением key: они соответствуют разным итерациям обработки.
 
**Целевой признак** - конечная температура - температура, замеренная непосредственно перед разливом стали, после всех этапов обработки и легирования.

## План работы

1. Данные загружены, проведен первичный анализ, анализ распределения на нормальность (графический и стат.тест), анализ выбросов. Заменены типы данных на datetime, гд это необходимо.

2. В датасетах с дозировками сыпучих и проволочных добавок заменены пропуски на 0. В датасете с температурой удалены партии с пропущенным целевым признаком. Удаалено аномальной значение мощности.

3. Факторы сведены в единую таблицу. Проведена проверка взаимосвязей между признаками. Удалены из модели факторы с очень высокой теснотой связи по Чеддоку (исп.коэффициент корреляции Спирмана). Удалены из модели факторы, не несущие ценной информации (время подачи добавок).

4. Проведено разделение на тренировочную и тестовую выборку (0,75/0,25) методом train_test_split. Выделены features и target. Проведено масштабирование и стандартизация признаков.

5. Проведено обучение регрессионных моделей с подбором гиперпараметров Gridsearch:

- LinearRegression,
- LASSO,
- DecisionTreeRegressor,
- RandomForestRegressor,
- CatBoostRegressor,
- LGBMRegressor.

В качестве метрики выбрана NMAE (MAE для CAtBoost).

Приемлемые результаты на тренировочной и тестовой выборке, наряду с лучшей моделью, показали модели LGBMRegressor, RandomForestRegressor.

7. Выполнена оценки эффективности модели с оптимальным значением на трейне на тестовой выборке. Выполнен анализ важности факторов у модели-победителя.
Можно отметить, что все поставленные в плане проекта шаги были реализованы. Спорным моментом было принятие решения об использовании значений времени подачи легирующих добавок в построении модели. В рамках проекта эти факторы решено было не включать в анализ.

8. Ключевым шагом в подготовке финального датасета для обучения моделей стоит признать точное определение целевой переменной - конечной температуры. Необходимо было сопоставить время последнего замера температуры с остальными временными значениями, чтобы удалить из датасета наблюдения, где после последних данных о температуре проводилась дальнейшая доработка сплава.

## Результат решения

В качестве итоговой модели выбран Градиентный Бустинг (реализация CatBoost).

Качество модели по метрике MAE на тестовой выборке составила 6.22 градуса.

**Ключевая ркомендация - для повышения энергоэффективности необходимо более точно нормировать температуру сплава на входе в обработку, а также корректировать параметр активной мощности на этапе обработки.**

Также можно сделать вывод, что проволочные и сыпучие добавки, за исключением wire_1, bulk_6 и wire_2, не влияют существенно на динамику температуры. Возможно, из-за сравнительно небольших дозировок. Поэтому корректировать их в целях энергосбережения пока не кажется эффективным способом. Однако здесь может быть пространство для поиска, если расширить датасет, пополнив его наблюдениями. В нашем проекте наблюдния с применением ряда добавок были единичными, их могло не хватить для полноценного и качественного анализа.

Вероятно, целесообразной рекомендацией для Заказчика будет в данном случае контролировать влияющими параметрами некий диапазон допустимых температур, а не строгое заданное значение. И анализировать отдельно наблюдения, выходящие за границы этого диаазона "нормальных" температур (какой набор факторов привел к выходу за границу энергоэффеективного диапазон).


## Используемые инструменты

`pandas` `numpy` `matplotlib` `seaborn` `plotly` `scipy` `sklearn` `catboost` `lightgbm`
